<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Agent Sudo CTF - Penetration Testing Notes</title> <link rel="shortcut icon" href="/pen-test-docs/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/pen-test-docs/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/pen-test-docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/pen-test-docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Agent Sudo CTF | Penetration Testing Notes</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Agent Sudo CTF" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documented notes and learning for penetration testing and related cyber security testing." /> <meta property="og:description" content="Documented notes and learning for penetration testing and related cyber security testing." /> <link rel="canonical" href="https://alipali737.github.io/pen-test-docs/Practice-Labs/tryhackme/Agent%20Sudo%20CTF.html" /> <meta property="og:url" content="https://alipali737.github.io/pen-test-docs/Practice-Labs/tryhackme/Agent%20Sudo%20CTF.html" /> <meta property="og:site_name" content="Penetration Testing Notes" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Agent Sudo CTF" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documented notes and learning for penetration testing and related cyber security testing.","headline":"Agent Sudo CTF","url":"https://alipali737.github.io/pen-test-docs/Practice-Labs/tryhackme/Agent%20Sudo%20CTF.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <script type="text/javascript" src="/pen-test-docs/assets/js/toggle_init.js"></script> <div class="side-bar"> <div class="site-header"> <a href="/pen-test-docs/" class="site-title lh-tight"> Penetration Testing Notes </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/" class="nav-list-link">Home</a></li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/setting-up/setting-up.html" class="nav-list-link">Setting Up</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/setting-up/Logging.html" class="nav-list-link">CLI Logging</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/Containers.html" class="nav-list-link">Containers</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/operating-systems.html" class="nav-list-link">Operating Systems</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/Screenshotting.html" class="nav-list-link">Screenshotting</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/useful-git-repos.html" class="nav-list-link">Useful Github Repos</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/virtual-private-servers.html" class="nav-list-link">Virtual Private Servers</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/Virtualization.html" class="nav-list-link">Virtualization</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/Attacks%20Index.html" class="nav-list-link">Attacks</a><ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/osint/OSINT%20Index.html" class="nav-list-link">Open-source Intelligence</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Attacks/osint/OSINT%20Framework.html" class="nav-list-link">OSINT Framework</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Index.html" class="nav-list-link">SQL Injection</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Attacks/sql-injection/Introduction.html" class="nav-list-link">Introduction</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/sql-injection/Basic%20SQL%20Syntax.html" class="nav-list-link">Basic SQL Syntax</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Cheatsheet.html" class="nav-list-link">SQL Injection Cheatsheet</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/web-application/Web%20Application%20Index.html" class="nav-list-link">Web Application</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Cross-Site%20Request%20Forgery%20(CSRF).html" class="nav-list-link">Cross-Site Request Forgery (CSRF)</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Cross-Site%20Scripting%20(XSS).html" class="nav-list-link">Cross-Site Scripting (XSS)</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Directory%20Enumeration%20Attack.html" class="nav-list-link">Directory Enumeration Attack</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Server%20Side%20Includes%20(SSI%20Framework)%20(.shtml).html" class="nav-list-link">Server Side Includes (SSI Framework) (.shtml)</a></li> </ul> </li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Knowledge%20Index.html" class="nav-list-link">Knowledge</a><ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Networks/Networks%20Index.html" class="nav-list-link">Networks</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Knowledge/Networks/TCP-IP%20Framework.html" class="nav-list-link">TCP/IP Framework</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Knowledge/Networks/Wireless%20Network%20Security.html" class="nav-list-link">Wireless Network Security</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Testing/Testing%20Index.html" class="nav-list-link">Testing</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Knowledge/Testing/Application%20Security%20Testing%20Methods.html" class="nav-list-link">Application Security Testing Methods</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Tools/Tools%20Index.html" class="nav-list-link">Tools</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Knowledge/Tools/Nmap.html" class="nav-list-link">Nmap</a></li> </ul> </li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Courses/Courses%20Index.html" class="nav-list-link">Courses</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Courses/Penetration%20Testing%20Fundamentals%20Bootcamp.html" class="nav-list-link">Penetration Testing Fundamentals Bootcamp</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Practice-Labs/labs%20index.html" class="nav-list-link">Practice Labs</a><ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Practice-Labs/overthewire/overthewire%20index.html" class="nav-list-link">OverTheWire</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Practice-Labs/overthewire/Bandit.html" class="nav-list-link">Bandit Lab</a></li> </ul> </li> <li class="nav-list-item"><a href="/pen-test-docs/Practice-Labs/tryhackme/tryhackme%20index.html" class="nav-list-link">TryHackMe</a></li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Practice-Labs/vulnhub/vulnhub%20index.html" class="nav-list-link">VulnHub</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Practice-Labs/vulnhub/Empire%20-%20Breakout.html" class="nav-list-link">Empire: Breakout CTF</a></li> </ul> </li> </ul> </li> </ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Penetration Testing Notes" aria-label="Search Penetration Testing Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/alipali737/pen-test-docs" class="site-button" > Github Source </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="agent-sudo-ctf"> <a href="#agent-sudo-ctf" class="anchor-heading" aria-labelledby="agent-sudo-ctf"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Agent Sudo CTF </h1> <details open=""> <summary class="text-delta"> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Table of contents
</code></pre></div> </div> </summary> </details><hr /> <p>Starting off with a normal scan: <code class="language-plaintext highlighter-rouge">nmap -sCV -v -oN</code> gives us information on 3 ports:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Port</th> <th>Service</th> <th>Version</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>80/tcp</td> <td>Apache httpd (Ubuntu)</td> <td>2.4.29</td> <td>Apache web server supporting GET HEAD POST OPTIONS</td> </tr> <tr> <td>22/tcp</td> <td>ssh</td> <td>OpenSSH 7.6p1</td> <td>SSH</td> </tr> <tr> <td>21/tcp</td> <td>ftp</td> <td>vsftpd 3.0.3</td> <td>FTP served using vsftpd</td> </tr> </tbody> </table></div> <p>Looking at the webserver, we need to send a codename as the <code class="language-plaintext highlighter-rouge">user-agent</code> in a request to access a secret page.</p> <p>![[Pasted image 20231029150714.png]]</p> <p>When we use <code class="language-plaintext highlighter-rouge">user-agent: R</code> we get a hint which suggests we are looking for a limited number of agents:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>What are you doing! Are you one of the 25 employees? If not, I going to report this incident
</code></pre></div></div> <p>Using Berp Intruder, I iterated through the capitalised alphabet and what do you know… <code class="language-plaintext highlighter-rouge">user-agent: C</code> redirects us to a new page! ![[Pasted image 20231029151546.png]]</p> <p>Now we know a possible username: <code class="language-plaintext highlighter-rouge">chris</code> we can attempt to brute-force the FTP credentials, using hydra we get out: <code class="language-plaintext highlighter-rouge">login: chris password: crystal</code>.</p> <p>Login in via FTP we can get 3 files (2 image files of aliens, and a text file containing a message to agent J):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Dear agent J,

All these alien like photos are fake! Agent R stored the real picture inside your directory. Your login password is somehow stored in the fake picture. It shouldn't be a problem for you.

From,
Agent C
</code></pre></div></div> <p>Doing an <code class="language-plaintext highlighter-rouge">exiftool cutie.png</code> suggests a warning that <code class="language-plaintext highlighter-rouge">Trailer data after PNG IEND chunk</code> exists. This is worth investigating as some data could be hidden here. Looking at the hex of this picture with <code class="language-plaintext highlighter-rouge">xxd cutie.png</code> we see a reference <code class="language-plaintext highlighter-rouge">To_agentR.txt</code>. It seems like there is a text file embedded in this image. Using <code class="language-plaintext highlighter-rouge">binwalk cutie.png</code> we can see there is a Zip archive hidden inside the image.</p> <p>Once extracted we can see that inside the Zip is the <code class="language-plaintext highlighter-rouge">To_agentR.txt</code> file but it is locked behind a password. Time to brute force it.</p> <p>Preparing with <code class="language-plaintext highlighter-rouge">zip2john 8702.zip &gt; hash.txt</code> we can obtain the hash of the zip ready for <code class="language-plaintext highlighter-rouge">john hash.txt</code>. Revealing the file password is <code class="language-plaintext highlighter-rouge">alien</code>. Unlocking the file tells us:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Agent C,

We need to send the picture to 'QXJlYTUx' as soon as possible!

By,
Agent R
</code></pre></div></div> <p>Base64’ing that string reveals it as <code class="language-plaintext highlighter-rouge">Area51</code>. Looking into the other image, maybe something is hidden in there? Running <code class="language-plaintext highlighter-rouge">steghide extract -sf cute-alien.jpg -p Area51</code> we extract a <code class="language-plaintext highlighter-rouge">message.txt</code>, reading:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hi james,

Glad you find this message. Your login password is hackerrules!

Don't ask me why the password look cheesy, ask agent R who set this password for you.

Your buddy,
chris
</code></pre></div></div> <p>Interestingly we now have a new name and password… Maybe they also have an FTP login? After trying to login via FTP it failed so maybe its an SSH login?</p> <p>Successfully logged into SSH with <code class="language-plaintext highlighter-rouge">james</code> and <code class="language-plaintext highlighter-rouge">hackerrules!</code> . First we can find the user flag in the home dir. Finally privilege escalation is required to access the root dirs. Some information gathering of the system can point us in the right direction for finding a priv esc:</p> <p><code class="language-plaintext highlighter-rouge">cat /etc/*-release</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=18.04
DISTRIB_CODENAME=bionic
DISTRIB_DESCRIPTION="Ubuntu 18.04.3 LTS"
NAME="Ubuntu"
VERSION="18.04.3 LTS (Bionic Beaver)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 18.04.3 LTS"
VERSION_ID="18.04"
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
VERSION_CODENAME=bionic
UBUNTU_CODENAME=bionic
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">sudo -l</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User james may run the following commands on agent-sudo:
    (ALL, !root) /bin/bash
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">(ALL, !root) /bin/bash</code> seems interesting… What this is telling us is that the user cannot run <code class="language-plaintext highlighter-rouge">/bin/bash</code> as root <code class="language-plaintext highlighter-rouge">(!root)</code>. This is explitable under https://nvd.nist.gov/vuln/detail/CVE-2019-14287.</p> <p>It suggests that the specification is:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root    ALL=(ALL:ALL) ALL
james   ALL=(ALL,!root) /bin/bash
</code></pre></div></div> <p>With ALL specified it means that a user (james) can run /bin/bash as any user they wish. Therefore we can choose to run <code class="language-plaintext highlighter-rouge">/bin/bash</code> as the root user which will be allowed.</p> <p><code class="language-plaintext highlighter-rouge">sudo -u#-1 /bin/bash</code> in this version of sudo, specifying the user id as <code class="language-plaintext highlighter-rouge">-1</code> or <code class="language-plaintext highlighter-rouge">4294967295</code> are resolved to <code class="language-plaintext highlighter-rouge">0</code>, which is the user ID for <code class="language-plaintext highlighter-rouge">root</code>.</p> <p>Finally we have gained full root access and retrieved the final flag found under the <code class="language-plaintext highlighter-rouge">/root</code> dir.</p> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">This page is being build from gh-pages at revision 356325f0939cd0b4bd7a9ff47d8bccd91b417980</p> </footer> </div> </div> <div class="search-overlay"></div> </div> <script type="text/javascript" src="/pen-test-docs/assets/js/toggle_mode.js"></script> </body> </html>
