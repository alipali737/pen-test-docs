<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Nmap - Penetration Testing Notes</title> <link rel="shortcut icon" href="/pen-test-docs/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/pen-test-docs/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/pen-test-docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/pen-test-docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Nmap | Penetration Testing Notes</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Nmap" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documented notes and learning for penetration testing and related cyber security testing." /> <meta property="og:description" content="Documented notes and learning for penetration testing and related cyber security testing." /> <link rel="canonical" href="https://alipali737.github.io/pen-test-docs/Knowledge/Tools/Nmap.html" /> <meta property="og:url" content="https://alipali737.github.io/pen-test-docs/Knowledge/Tools/Nmap.html" /> <meta property="og:site_name" content="Penetration Testing Notes" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Nmap" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Documented notes and learning for penetration testing and related cyber security testing.","headline":"Nmap","url":"https://alipali737.github.io/pen-test-docs/Knowledge/Tools/Nmap.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <script type="text/javascript" src="/pen-test-docs/assets/js/toggle_init.js"></script> <div class="side-bar"> <div class="site-header"> <a href="/pen-test-docs/" class="site-title lh-tight"> Penetration Testing Notes </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/" class="nav-list-link">Home</a></li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/setting-up/setting-up.html" class="nav-list-link">Setting Up</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/setting-up/Logging.html" class="nav-list-link">CLI Logging</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/Containers.html" class="nav-list-link">Containers</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/operating-systems.html" class="nav-list-link">Operating Systems</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/Screenshotting.html" class="nav-list-link">Screenshotting</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/useful-git-repos.html" class="nav-list-link">Useful Github Repos</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/virtual-private-servers.html" class="nav-list-link">Virtual Private Servers</a></li> <li class="nav-list-item"><a href="/pen-test-docs/setting-up/Virtualization.html" class="nav-list-link">Virtualization</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/Attacks%20Index.html" class="nav-list-link">Attacks</a><ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/osint/OSINT%20Index.html" class="nav-list-link">Open-source Intelligence</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Attacks/osint/OSINT%20Framework.html" class="nav-list-link">OSINT Framework</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Index.html" class="nav-list-link">SQL Injection</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Attacks/sql-injection/Introduction.html" class="nav-list-link">Introduction</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/sql-injection/Basic%20SQL%20Syntax.html" class="nav-list-link">Basic SQL Syntax</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/sql-injection/SQL%20Injection%20Cheatsheet.html" class="nav-list-link">SQL Injection Cheatsheet</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Attacks/web-application/Web%20Application%20Index.html" class="nav-list-link">Web Application</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Cross-Site%20Request%20Forgery%20(CSRF).html" class="nav-list-link">Cross-Site Request Forgery (CSRF)</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Cross-Site%20Scripting%20(XSS).html" class="nav-list-link">Cross-Site Scripting (XSS)</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Directory%20Enumeration%20Attack.html" class="nav-list-link">Directory Enumeration Attack</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Attacks/web-application/Server%20Side%20Includes%20(SSI%20Framework)%20(.shtml).html" class="nav-list-link">Server Side Includes (SSI Framework) (.shtml)</a></li> </ul> </li> </ul> </li> <li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Knowledge%20Index.html" class="nav-list-link active">Knowledge</a><ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Networks/Networks%20Index.html" class="nav-list-link">Networks</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Knowledge/Networks/TCP-IP%20Framework.html" class="nav-list-link">TCP/IP Framework</a></li> <li class="nav-list-item"><a href="/pen-test-docs/Knowledge/Networks/Wireless%20Network%20Security.html" class="nav-list-link">Wireless Network Security</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Testing/Testing%20Index.html" class="nav-list-link">Testing</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Knowledge/Testing/Application%20Security%20Testing%20Methods.html" class="nav-list-link">Application Security Testing Methods</a></li> </ul> </li> <li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Knowledge/Tools/Tools%20Index.html" class="nav-list-link active">Tools</a><ul class="nav-list"><li class="nav-list-item active"><a href="/pen-test-docs/Knowledge/Tools/Nmap.html" class="nav-list-link active">Nmap</a></li> </ul> </li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Courses/Courses%20Index.html" class="nav-list-link">Courses</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Courses/Penetration%20Testing%20Fundamentals%20Bootcamp.html" class="nav-list-link">Penetration Testing Fundamentals Bootcamp</a></li> </ul> </li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Practice-Labs/labs%20index.html" class="nav-list-link">Practice Labs</a><ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Practice-Labs/overthewire/overthewire%20index.html" class="nav-list-link">OverTheWire</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Practice-Labs/overthewire/Bandit.html" class="nav-list-link">Bandit Lab</a></li> </ul> </li> <li class="nav-list-item"><a href="/pen-test-docs/Practice-Labs/tryhackme/tryhackme%20index.html" class="nav-list-link">TryHackMe</a></li> <li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/pen-test-docs/Practice-Labs/vulnhub/vulnhub%20index.html" class="nav-list-link">VulnHub</a><ul class="nav-list"><li class="nav-list-item"><a href="/pen-test-docs/Practice-Labs/vulnhub/Empire%20-%20Breakout.html" class="nav-list-link">Empire: Breakout CTF</a></li> </ul> </li> </ul> </li> </ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Penetration Testing Notes" aria-label="Search Penetration Testing Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/alipali737/pen-test-docs" class="site-button" > Github Source </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"> <a href="/pen-test-docs/Knowledge/Knowledge%20Index.html">Knowledge</a> </li><li class="breadcrumb-nav-list-item"> <a href="/pen-test-docs/Knowledge/Tools/Tools%20Index.html">Tools</a> </li><li class="breadcrumb-nav-list-item"> <span>Nmap</span> </li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="nmap"> <a href="#nmap" class="anchor-heading" aria-labelledby="nmap"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Nmap </h1> <details open=""> <summary class="text-delta"> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Table of contents
</code></pre></div> </div> </summary> <ul id="markdown-toc"> <li><a href="#the-scanning-phase" id="markdown-toc-the-scanning-phase">The Scanning Phase</a></li> <li><a href="#what-is-nmap" id="markdown-toc-what-is-nmap">What is Nmap?</a></li> <li><a href="#why-use-nmap" id="markdown-toc-why-use-nmap">Why use Nmap?</a></li> <li><a href="#planning-before-scanning" id="markdown-toc-planning-before-scanning">Planning Before Scanning</a> <ul> <li><a href="#an-example" id="markdown-toc-an-example">An Example</a></li> </ul> </li> <li><a href="#ports" id="markdown-toc-ports">Ports</a></li> <li><a href="#using-nmap" id="markdown-toc-using-nmap">Using Nmap</a> <ul> <li><a href="#ping-sweeping" id="markdown-toc-ping-sweeping">Ping Sweeping</a></li> <li><a href="#tcp-connect-scan" id="markdown-toc-tcp-connect-scan">TCP Connect Scan</a></li> <li><a href="#tcp-syn-scan-stealthy-alternative" id="markdown-toc-tcp-syn-scan-stealthy-alternative">TCP SYN Scan (Stealthy alternative)</a></li> </ul> </li> <li><a href="#scripting-with-nmap-nse" id="markdown-toc-scripting-with-nmap-nse">Scripting with Nmap NSE</a> <ul> <li><a href="#creating-scripts-in-lua" id="markdown-toc-creating-scripts-in-lua">Creating Scripts in Lua</a> <ul> <li><a href="#the-head" id="markdown-toc-the-head">The HEAD</a></li> <li><a href="#the-rules" id="markdown-toc-the-rules">The RULES</a></li> <li><a href="#the-action" id="markdown-toc-the-action">The ACTION</a></li> <li><a href="#hello-world-script-example" id="markdown-toc-hello-world-script-example">Hello World Script Example</a></li> </ul> </li> </ul> </li> </ul> </details><hr /> <h2 id="the-scanning-phase"> <a href="#the-scanning-phase" class="anchor-heading" aria-labelledby="the-scanning-phase"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Scanning Phase </h2> <p>A security test follows the Hacking Process:</p> <ol> <li>Reconnaissance</li> <li><strong>Scanning</strong></li> <li>Enumeration</li> <li>System Hacking</li> <li>Escalation of Privilege</li> <li>Planting Backdoors</li> <li>Covering Tracks</li> </ol> <p>The scanning phase in a security test is to gain insights into the technical system data of systems on the network. Tools are used to scan for different technical network and system information. Dialers, Sweepers, Vulnerability scanners, and port scanners are all used in this phase.</p> <h2 id="what-is-nmap"> <a href="#what-is-nmap" class="anchor-heading" aria-labelledby="what-is-nmap"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What is Nmap? </h2> <p><a href="https://nmap.org/">Nmap</a>, Network Mapper, is a port scanner/network mapping tool. It is the most used scanning tool in the industry. It is an <em>open-source linux based cli tool</em>. The tool is designed to <em>scan systems/networks for IP addresses, system ports, OS details, and applications/services installed</em>.</p> <h2 id="why-use-nmap"> <a href="#why-use-nmap" class="anchor-heading" aria-labelledby="why-use-nmap"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Why use Nmap? </h2> <p>It has the ability to perform highly sophisticated mapping functions that <em>aim to go undetected by IDS/IPS</em>, it can also perform simple network commands. The Nmap Scripting Engine (NSE) provides comprehensive scripting capabilities. Some key benefits of Nmap are:</p> <ul> <li>Ability to <em>identify specific services running</em> on a system: DNS, web, email, SSH, etc.</li> <li>Ability to <em>gather OS-specific details</em> of target system.</li> <li>The <em>Zenmap’s GUI helps build visualisations of the scan results</em> of target networks/systems</li> <li>Ability to <em>identify and distinguish between different network devices</em>: routers, servers, switches, mobile devices, etc.</li> <li>The NSE. It allows for complex automation of Nmap’s power. The <em>NSE uses Lua</em> for scripting.</li> <li>Reusable attack scripts from the NSE repository.</li> </ul> <h2 id="planning-before-scanning"> <a href="#planning-before-scanning" class="anchor-heading" aria-labelledby="planning-before-scanning"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Planning Before Scanning </h2> <p>The activity of scanning can also be called <em>Foot-printing</em>. Before any port scanning can be conducted it is <strong>important to have a plan and objective</strong>.</p> <p>Foot-printing will help identify:</p> <ul> <li>Specific services used by the organisation</li> <li>Possible application versions</li> <li>Utilisation frequency by daytime</li> <li>And more</li> </ul> <p>This information may help determine the target application, service, host. and/or port to locate on the network.</p> <p>The first step before doing any detailed scans is to <em>map the network</em>. This will give you a list of all ‘up’ or active hosts on the network. <em>Port scanning on these hosts</em> can then be conducted. By <em>correlating the information</em> collected during foot-printing, specific scan types may be executed to <em>find the available ports on a system</em>.</p> <h3 id="an-example"> <a href="#an-example" class="anchor-heading" aria-labelledby="an-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> An Example </h3> <p><strong>The Example:</strong></p> <ul> <li>It is discovered that a target organisation is using <em>MS SharePoint 2003, a product that reached EoL in 2014</em>.</li> <li>Since its EoL two vulnerabilities have been reported in that version. When conducting scans a <em>public-facing SharePoint webpage was located with listening (open) port 8080</em>.</li> </ul> <p><strong>Example Review:</strong></p> <ul> <li>After discovery of this potential weakness, the <em>objective was to locate any servers running SharePoint 2003</em>.</li> <li><em>Nmap scans identified public-facing open ports</em>.</li> <li>Recommendations to either <em>upgrade or remove the SharePoint 2003</em> servers.</li> </ul> <h2 id="ports"> <a href="#ports" class="anchor-heading" aria-labelledby="ports"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ports </h2> <p>Ports are between 0-65,535.</p> <ul> <li><strong>Ports 0 - 1023</strong> (aka <em>Well-Known Ports</em>): Assigned to universal TCP/IP application protocols. Most common examples: HTTPS, SSH, FTP, DNS, etc. They are registered to these protocols by a global authority.</li> <li><strong>Ports 1024 - 49,151</strong> (aka <em>Registered Ports</em>): Reserved for application protocols that are not specified as universal.</li> <li><strong>Ports 49,152 - 65,535</strong> (aka <em>Private/Dynamic Ports</em>): These ports may be used for any process without registering the port with the global assigning authority.</li> </ul> <h2 id="using-nmap"> <a href="#using-nmap" class="anchor-heading" aria-labelledby="using-nmap"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using Nmap </h2> <p>A basic scan uses the following format:</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">nmap <span class="o">{</span>Scan Type<span class="o">(</span>s<span class="o">)}</span> <span class="o">{</span>options<span class="o">}</span> <span class="o">[</span>target]</code></pre></figure> <p>Nmap can take targets as IPv4/IPv6/URLs/Fully Qualified Domain Name (FQDN).</p> <h3 id="ping-sweeping"> <a href="#ping-sweeping" class="anchor-heading" aria-labelledby="ping-sweeping"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ping Sweeping </h3> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">nmap <span class="nt">-sn</span> <span class="o">[</span>target range]</code></pre></figure> <p>A ping sweep can be used to scan a network for available hosts, it does this by iterating through a range of addresses sending an <em>Internet Control Message Protocol (ICMP)</em> packet. It is a discovery scan.</p> <details> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;summary&gt;Example Ping Sweep&lt;/summary&gt;
</code></pre></div> </div> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">	<span class="nv">$ </span>nmap <span class="nt">-sn</span> 192.168.1.1-254  
	Starting Nmap 7.70 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-06-01 13:01 EST  
	Nmap scan report <span class="k">for </span>192.168.1.96  
	Host is up <span class="o">(</span>0.064s latency<span class="o">)</span><span class="nb">.</span>  
	Nmap scan report <span class="k">for </span>192.168.1.118  
	Host is up <span class="o">(</span>0.029s latency<span class="o">)</span><span class="nb">.</span>  
	Nmap scan report <span class="k">for </span>192.168.1.128  
	Host is up <span class="o">(</span>1.18s latency<span class="o">)</span><span class="nb">.</span>  
	Nmap scan report <span class="k">for </span>192.168.1.171  
	Host is up <span class="o">(</span>0.0094s latency<span class="o">)</span><span class="nb">.</span>  
	Nmap scan report <span class="k">for </span>192.168.1.179  
	Host is up <span class="o">(</span>0.064s latency<span class="o">)</span><span class="nb">.</span>  
	Nmap scan report <span class="k">for </span>192.168.1.210  
	Host is up <span class="o">(</span>0.0066 latency<span class="o">)</span><span class="nb">.</span>  
	Nmap scan report <span class="k">for </span>192.168.1.253  
	Host is up <span class="o">(</span>0.0049 latency<span class="o">)</span><span class="nb">.</span>  
	Nmap <span class="k">done</span>: 254 IP addresses <span class="o">(</span>7 hosts up<span class="o">)</span> scanned <span class="k">in </span>7.90 seconds
	</code></pre></figure> </details> <h3 id="tcp-connect-scan"> <a href="#tcp-connect-scan" class="anchor-heading" aria-labelledby="tcp-connect-scan"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> TCP Connect Scan </h3> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">nmap <span class="nt">-sT</span> <span class="o">[</span>target]</code></pre></figure> <p>TCP establishes a 3-way handshake. Nmap uses this handshake to determine if a port is open:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Nmap</th> <th> </th> <th>Server</th> </tr> </thead> <tbody> <tr> <td>SYN (request port 22 connection)</td> <td>–&gt;</td> <td> </td> </tr> <tr> <td> </td> <td>&lt;–</td> <td>SYN/ACK (Port is open, Go ahead!)</td> </tr> <tr> <td>ACK (Connection Established)</td> <td>–&gt;</td> <td> </td> </tr> <tr> <td> </td> <td>&lt;–</td> <td>Data: SSH banner message</td> </tr> <tr> <td>RST (Kill Connection)</td> <td>–&gt;</td> <td> </td> </tr> </tbody> </table></div> <h3 id="tcp-syn-scan-stealthy-alternative"> <a href="#tcp-syn-scan-stealthy-alternative" class="anchor-heading" aria-labelledby="tcp-syn-scan-stealthy-alternative"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> TCP SYN Scan (Stealthy alternative) </h3> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">nmap <span class="nt">-sS</span> <span class="o">[</span>target]</code></pre></figure> <p>This scan type only performs a partial 3-way handshake, unlike the TCP Connect Scan. It does this by never sending the final ACK packet upon receipt of the SYN/ACK response from the server.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Nmap</th> <th> </th> <th>Server</th> </tr> </thead> <tbody> <tr> <td>SYN (request port 22 connection)</td> <td>–&gt;</td> <td> </td> </tr> <tr> <td> </td> <td>&lt;–</td> <td>SYN/ACK (Port is open, Go ahead!)</td> </tr> <tr> <td>RST (Kill Connection)</td> <td>–&gt;</td> <td> </td> </tr> </tbody> </table></div> <h2 id="scripting-with-nmap-nse"> <a href="#scripting-with-nmap-nse" class="anchor-heading" aria-labelledby="scripting-with-nmap-nse"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scripting with Nmap NSE </h2> <p><em>Nmap Scripting Engine (NSE)</em> is an important feature of Nmap as it allows for complex automation of various networking tasks. These could range from finding vulnerabilities in networks, identifying possible backdoors, or exploiting a vulnerability in a target system.</p> <p>Nmap uses <em>Lua</em> as its scripting language as it has been embedded into the engine.</p> <p>Some benefits to scripting with Nmap:</p> <ul> <li>More flexibility and efficiency with network discovery and security audits</li> <li>Can be more <em>proactive</em> rather than <em>reactive</em> when dealing with system vulnerabilities</li> <li>Cover more ground with less effort</li> </ul> <p>For example, a script could be created to take action if a network vulnerabilities is found within a system.</p> <p>The Nmap help page gives us some basics for <em>SCRIPT SCAN</em>ning. We can:</p> <ul> <li>Provide script file(s)</li> <li>Provide arguments to scripts</li> <li>Provide NSE script arguments in a file</li> <li>Show all data sent and recieved</li> <li>Update a script database</li> <li>Get help with scripting</li> </ul> <figure class="highlight"><pre><code class="language-shell" data-lang="shell">SCRIPT SCAN:  
  -sC: equivalent to <span class="nt">--script</span><span class="o">=</span>default  
  --script<span class="o">=</span>&lt;Lua scripts&gt;: &lt;Lua scripts&gt; is a comma separated list of  
           directories, script-files or script-categories  
  --script-args<span class="o">=</span>&lt;<span class="nv">n1</span><span class="o">=</span>v1,[n2<span class="o">=</span>v2,...]&gt;: provide arguments to scripts  
  --script-args-file<span class="o">=</span>filename: provide NSE script args <span class="k">in </span>a file  
  --script-trace: Show all data sent and received  
  --script-updatedb: Update the script database.  
  --script-help<span class="o">=</span>&lt;Lua scripts&gt;: Show <span class="nb">help </span>about scripts.  
           &lt;Lua scripts&gt; is a comma-separated list of script-files or  
           script-categories.</code></pre></figure> <p>More detail can be found on the <a href="https://nmap.org/book/man-nse.html">Nmap Scripting Engine website</a>.</p> <p>The <code class="language-plaintext highlighter-rouge">-sC</code> flag specifies that for every service discovered, run the default script. This could be useful in finding out additional information about a service eg. It could discover HTTP headers, email information from a page etc</p> <h3 id="creating-scripts-in-lua"> <a href="#creating-scripts-in-lua" class="anchor-heading" aria-labelledby="creating-scripts-in-lua"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating Scripts in Lua </h3> <p>The anatomy of an NSE Script:</p> <figure class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">-- HEAD</span>

<span class="c1">-- RULES</span>

<span class="c1">-- ACTION</span></code></pre></figure> <h4 id="the-head"> <a href="#the-head" class="anchor-heading" aria-labelledby="the-head"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The HEAD </h4> <p>The <code class="language-plaintext highlighter-rouge">HEAD</code> section of the script contains meta information about your script</p> <ul> <li><code class="language-plaintext highlighter-rouge">require</code> statements specify dependencies</li> </ul> <figure class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">package1</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">"package1"</span>
<span class="kd">local</span> <span class="n">package2</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">"package2"</span></code></pre></figure> <ul> <li><code class="language-plaintext highlighter-rouge">description</code> is a variable that describes what the script does</li> </ul> <figure class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">description</span> <span class="o">=</span> <span class="s">[[
	Detailed description here!
]]</span></code></pre></figure> <ul> <li><code class="language-plaintext highlighter-rouge">author</code>, <code class="language-plaintext highlighter-rouge">license</code>, and <code class="language-plaintext highlighter-rouge">categories</code> variables</li> </ul> <figure class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">author</span> <span class="o">=</span> <span class="s2">"Your Name"</span>

<span class="n">license</span> <span class="o">=</span> <span class="s2">"Same as Nmap -- See https://nmap.org/book/man-legal.html"</span>

<span class="n">categories</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"default"</span><span class="p">,</span> <span class="s2">"safe"</span><span class="p">}</span></code></pre></figure> <p><a href="https://nmap.org/book/nse-usage.html">We can see some common categories on the Nmap website</a>. By adding the category <code class="language-plaintext highlighter-rouge">"default"</code>, this script would run when we use the <code class="language-plaintext highlighter-rouge">-sC</code> or <code class="language-plaintext highlighter-rouge">-A</code> configuration options. We’ll also say this script is <code class="language-plaintext highlighter-rouge">"safe"</code> because we aren’t planning to crash or hurt anything with our script!</p> <h4 id="the-rules"> <a href="#the-rules" class="anchor-heading" aria-labelledby="the-rules"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The RULES </h4> <p>The <code class="language-plaintext highlighter-rouge">RULES</code> of the script is the portion of the code that determins if the script will run or not. For example, if port 80 isn’t open, maybe we can’t run out HTTP-specific script. In that case, we should terminate the script.</p> <p>The script will always include one of:</p> <ul> <li><code class="language-plaintext highlighter-rouge">prerule()</code> - This rule runs during the pre-scanning phase, before any hosts have been scanned. Useful for discovery scripts.</li> <li><code class="language-plaintext highlighter-rouge">hostrule(host)</code> - This rule runs after each batch of hosts have been scanned.</li> <li><code class="language-plaintext highlighter-rouge">portrule(host, port)</code> - This rule runs after each batch of ports have been scanned.</li> <li><code class="language-plaintext highlighter-rouge">postrule()</code> - This rule is checked after the scan has completed. Useful for any scripts reviewing the full results of a scan.</li> </ul> <h4 id="the-action"> <a href="#the-action" class="anchor-heading" aria-labelledby="the-action"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The ACTION </h4> <p>This is where the actual functionality of the script is defined. If the RULE passes, then this section will be executed.</p> <h4 id="hello-world-script-example"> <a href="#hello-world-script-example" class="anchor-heading" aria-labelledby="hello-world-script-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Hello World Script Example </h4> <figure class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">-- HEAD</span>
<span class="kd">local</span> <span class="n">nmap</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">"nmap"</span>

<span class="n">description</span> <span class="o">=</span> <span class="s">[[
  "Hello world script"
]]</span>

<span class="n">author</span> <span class="o">=</span> <span class="s2">"alipali737"</span>
<span class="n">license</span> <span class="o">=</span> <span class="s2">"Same as Nmap--See https://nmap.org/book/man-legal.html"</span>
<span class="n">categories</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"safe"</span><span class="p">}</span>

<span class="c1">-- RULES</span>
<span class="n">portrule</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">port_to_check</span> <span class="o">=</span> <span class="p">{</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span> <span class="n">protocol</span> <span class="o">=</span> <span class="s2">"tcp"</span> <span class="p">}</span>
  <span class="kd">local</span> <span class="n">port_state</span> <span class="o">=</span> <span class="n">nmap</span><span class="p">.</span><span class="n">get_port_state</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port_to_check</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">port_state</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="ow">and</span> <span class="n">port_state</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">"open"</span>
<span class="k">end</span>

<span class="c1">-- ACTION</span>
<span class="n">action</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
  <span class="k">return</span> <span class="s2">"Hello, port "</span><span class="o">..</span><span class="n">port</span><span class="p">.</span><span class="n">number</span><span class="o">..</span><span class="s2">"!"</span>
<span class="k">end</span></code></pre></figure> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">This page is being build from gh-pages at revision 356325f0939cd0b4bd7a9ff47d8bccd91b417980</p> </footer> </div> </div> <div class="search-overlay"></div> </div> <script type="text/javascript" src="/pen-test-docs/assets/js/toggle_mode.js"></script> </body> </html>
